# --- General Settings ---
set -g default-terminal "xterm-ghostty"
# FIX: force rgb/true color
set -as terminal-features ",xterm-ghostty:256:RGB:UTF8"
set -as terminal-overrides ",xterm-ghostty:nc"
set -ag terminal-overrides ",xterm-ghostty:Tc"
# --- Undercurl Support ---
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'
set -g default-shell /usr/bin/zsh
set -g mouse on
set -sg escape-time 0
set -g focus-events on


# Nav
unbind C-b
set -g prefix C-s
bind C-s send-prefix
unbind r
bind r source-file ~/.tmux.conf \; display " Tmux config reloaded!"
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

bind H set status

# --- UI & Window Management ---
set -g base-index 1
setw -g pane-base-index 1
set -g status-position top
set -g status-interval 2
set -g allow-passthrough on


# -----------------------------------------------------------------------------
# --- THE CUSTOM BAR BUILD ---
# -----------------------------------------------------------------------------


set -g pane-border-style fg=#b1bac4
set -g pane-active-border-style fg=#ff7b72
set -g status on
#set -g 'status-format[1]' ''
set -g status-justify centre


# Hardcode your tokyodark hex #11121d here. 
# Do NOT use "bg=default", as tmux interprets "default" incorrectly in Ghostty sometimes.
set -g status-style "bg=#1B1B1B,fg=#a0a8cd"

# LEFT SIDE:
set -g @net_speed_format "%7s  %7s " 
set -g @net_speed_interfaces 'wlan0' # Ensure this matches `ip link` output
run-shell -b 'while true; do ~/.local/bin/tmux-net-status.sh; sleep 5; done'
set -g status-left-length 200
set -g status-left "#[fg=#11121D,bold]#[bg=#1b1b1b,fg=#a0a8cd,bold]#[bg=default,fg=#f0f6fc,bold]#[fg=#f0f6fc]#{@net_status}\u00a0#{net_speed}#[default]"


# WINDOW LIST:
set -g window-status-format "#[fg=#343434] #I:#W "
#set -g window-status-current-format "#[fg=#9EEF00, bold]#[bg=#9EEF00,fg=#9EEF00,bold]#I:#W#[fg=#9EEF00, bold]"
set -g window-status-current-format "#[fg=#11121D,bold]#[bg=#1b1b1b,fg=#ff7b72,bold]#I:#W#[bg=#11121D,fg=#11121D,bold]#[#11121D]"


# RIGHT SIDE:
set -g status-right-length 200
#set -g status-right "#{?client_prefix,#[fg=#ee6d85]#[bold],#[fg=#343434]#[nobold]}MOD #[fg=#a0a8cd,bold] #[fg=#a0a8cd,bold]PWR #{battery_percentage} #[fg=#a0a8cd,bold] #[fg=#a0a8cd]MEM #{ram_percentage} #[fg=#a0a8cd,bold] #[fg=#a0a8cd,bold][%H:%M]  "
#set -g status-right "#{?client_prefix,#[fg=#ee6d85]#[bold],#[fg=#343434]#[nobold]}MOD  #[default]#[fg=#a0a8cd,bold]PWR #{battery_percentage} #[fg=#a0a8cd]MEM #{ram_percentage} #[fg=#9EEF00,bold]#[bg=#9EEF00,fg=#11121D,bold]%H:%M#[bg=default,fg=#9EEF00,bold]#[default]"
set -g status-right "#{?client_prefix,#[fg=#ff7b72]#[bold],#[fg=#343434]#[nobold]} PREFIX\u00a0#[default]#[fg=#f0f6fc,bold] bat:#{battery_percentage}\u00a0#[fg=#f0f6fc] mem:#{ram_percentage}#[fg=#11121D,bold]#[bg=#1b1b1b,fg=#a0a8cd,bold]#[bg=1b1b1b,fg=#9EEF00,bold]#[default]"



# Plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'jimeh/tmux-net-speed'


run '~/.tmux/plugins/tpm/tpm'
